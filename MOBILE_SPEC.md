# 手机版 PWA 笔记功能设计（对齐当前移动端架构）

本文将《autogen-note》原始需求中的“手机侧”能力对齐到当前 PWA 页面原型架构。遵循两条约束：
- 不涉及“三库”（权威库/向量库/GraphRAG）对接，手机端仅以 Markdown 文档作为第一级数据存储。
- 不新增左右/顶部滑动交互，沿用当前页面的菜单结构与按钮布局；但需要将“议题、标签、会话”的能力以合适的方式“塞进”现有菜单结构中。

本文为独立设计文档，不涉及代码修改。

---

## 1. 目标与范围
- 目标：在当前移动端 PWA 原型 UI/菜单结构不大改的前提下，完成“议题-标签-会话”的最小可用实现；以本地 Markdown 文档为第一级存储，支持创建/编辑/浏览/简单导出。
- 范围：
  - 仅手机端（PWA）。
  - 仅本地 Markdown 存储（可扩展 IndexedDB）。
  - 不实现三库策略、不接入后端 Agent/Team；但预留菜单与数据结构。

## 2. 架构对齐（现有页面元素）
- 顶部栏 `header.topbar`：已含 App 标题与右侧菜单按钮。
- 主内容 `main.content`：输出区（阅读）+ 输入区（编辑）上下布局（输出区高度约为输入区 3 倍）。
- 底部栏 `footer.bottombar`：保留“分类/新建/安装”按钮位。
- 现有抽屉（不新增手势）：
  - 左侧抽屉 `#left-drawer`：导航与功能入口（可放“议题/标签”管理入口）。
  - 右侧抽屉 `#right-drawer`：工具区（改造为“会话/设置”双 Tab）。
  - 顶部抽屉 `#top-drawer`：快速操作（搜索、新建）。

> 注：不新增“边缘滑动打开”作为强依赖，点击按钮打开抽屉即可。

## 3. 信息结构（手机端）
- 议题 Topic
  - 字段：`id, name, tags[], favorite(bool), archived(bool), createdAt, updatedAt`
  - 关系：一个议题下包含多个会话笔记块 NoteBlock。
- 标签 Tag
  - 字段：`id, name, color(optional)`
  - 关系：多对多（议题与标签）。
- 会话笔记块 NoteBlock
  - 字段：`id, topicId, contentMD, createdAt, favorite(bool)`
  - 说明：contentMD 作为一级数据存储（Markdown）；本期不做入库到三库。
- 视图/筛选
  - 当前议题/归档议题 列表
  - 标签过滤：多选标签 → 过滤议题列表

## 4. 菜单与 UI 映射（不改动整体布局）
- 左抽屉（导航）：
  - 菜单项：
    - 全部笔记（= 所有议题）
    - 收藏（收藏的议题）
    - 标签（进入“标签管理”页）
    - 设置（占位）
  - 左抽屉底部：
    - 按钮“＋ 新建议题” → 弹出“议题名称”输入框 → 创建 Topic。

- 右抽屉（工具 → 调整为 Tab）：
  - Tab1：会话
    - 展示当前议题下的 NoteBlock 列表
    - 列表项：标题（首行 Markdown 文本截断）+ 时间 + 操作图标（收藏、删除、复制）
  - Tab2：设置（占位）
    - 预留与 PC 端 Team/Agent 对齐的设置入口（仅展示，不实现调用）。

- 顶部抽屉（快速操作）：
  - 搜索（按议题名/标签/笔记块首行模糊搜索）
  - “新建笔记”（= 在当前议题下创建空 NoteBlock，光标聚焦到输入区）

- 主内容（输出/输入）：
  - 输出区：
    - 渲染当前议题下的 NoteBlock 列表（按时间倒序），支持滚动。
    - 点击右抽屉会话项 → 输出区滚动定位对应 NoteBlock。
    - 删除右抽屉某会话项 → 输出区同步移除对应块（弹确认）。
  - 输入区：
    - Markdown 编辑器（简易工具条：粗体、标题、链接、列表、代码、复制/粘贴）
    - “提交”按钮（替代 Alt+Enter）：
      - 将输入内容作为新的 NoteBlock 追加到当前议题（输出区顶部显示）
      - 提交后清空输入框

## 5. 交互流程
- 新建议题：左抽屉“＋ 新建议题” → 输入名称 → 生成 Topic（默认标签为空、favorite=false、archived=false）。
- 重命名议题：在左抽屉议题列表中，长按或“更多”菜单 → 改名。
- 收藏/归档/删除议题：
  - 收藏 toggle；收藏状态不允许删除。
  - 归档后从“当前”转至“归档”分组；
  - 删除议题 → 连带删除旗下所有 NoteBlock（弹确认）。
- 标签管理：
  - 入口：左抽屉“标签”
  - 功能：新增/改名/删除标签；多选标签筛选议题列表；为议题绑定/解绑标签。
- 新建笔记块（NoteBlock）：
  - 顶部抽屉“新建笔记”或主输入区“提交”按钮
  - 提交后：
    - 追加到输出区顶部
    - 右抽屉会话 Tab 同步新增条目
    - 输入框清空
- 删除/收藏/复制笔记块：
  - 在右抽屉“会话”Tab 列表项上操作
  - 删除需要二次确认；收藏 toggle；复制将 Markdown 文本写入剪贴板
- 搜索：
  - 顶部抽屉输入关键词，匹配议题名/标签/笔记块首行。

## 6. 数据存储（第一级：Markdown）
- 存储策略：
  - 运行期内存结构（Topic/Tag/NoteBlock） → 持久化为 Markdown + JSON 清单。
  - 推荐结构：
    - `notes/manifest.json`（Topic/Tag/NoteBlock 的索引、关系、排序）
    - `notes/{topicId}/{blockId}.md`（每个笔记块一个 MD 文件）
  - 导出：
    - 议题导出：将一个 Topic 下的所有 MD 合并为单一 Markdown（附资源清单）。
- 持久化介质：
  - v1：使用浏览器 `IndexedDB`/`localStorage` + File System Access API（如可用）
  - v2：可选下载 zip 包（manifest.json + 所有 .md）作为本地备份

> 说明：v1 仍保持“第一级是 MD 文档”，只是在浏览器端采用清单与多文件的方式组织；未来可无缝同步到后端或三库。

## 7. PWA 能力与离线
- manifest + service worker 保持现状：
  - HTML：network-first
  - 静态资源：cache-first
  - 数据文件（manifest.json 与 .md）：首次成功获取后加入缓存，离线可读；提交时若离线，暂存于 IndexedDB，待在线时后台 flush。

## 8. 不做与边界
- 不做：
  - 三库写入与检索（向量化/GraphRAG）。
  - Agent/Team 实际调用与运行。
- 边界：
  - 手机端仅做“议题/标签/会话 + Markdown 存储”的骨干能力。

## 9. 可扩展点（为后续对接预留）
- Team/Agent 设置 Tab 仅作为占位，未来接入 Autogen 0.7.1 的内生机制（MCP/工具调用/会话）。
- API 契约占位（不实现）：
  - POST /api/topics, DELETE /api/topics/:id, POST /api/topics/:id/export
  - GET/POST /api/notes, DELETE /api/notes/:id
  - GET/PUT /api/tags
- 同步策略：
  - v2 可加入“导出/导入”zip 实现多设备迁移。

## 10. 里程碑（手机端）
- M1 最小可用：
  - 议题/标签/会话的 UI 映射落地（菜单 → 抽屉/Tab）
  - 输入→提交→展示→删除/收藏/复制 的闭环
  - Markdown 清单与 .md 文件的初级持久化（IndexedDB + 可下载备份）
- M2 体验打磨：
  - 搜索、标签过滤、列表性能优化
  - 议题导出为 Markdown（文本 + 资源清单）
  - 离线提交缓冲与在线 flush
- M3 预留对接：
  - Team/Agent Tab 的表单持久化
  - （仅占位）后台 API 与三库对接开关

---

## 附录：UI 元素与行为（对照现有原型）
- 顶部栏按钮：
  - 左侧按钮：打开左抽屉（议题/标签/设置）
  - 右侧按钮：打开右抽屉（会话/设置 Tab）
- 顶部抽屉：
  - 搜索框 + “新建笔记”按钮
- 主内容：
  - 上：输出区（按 NoteBlock 列表渲染）
  - 下：输入区（Markdown 编辑器 + “提交”按钮）
- 底部栏：
  - “分类”（= 打开左抽屉）
  - “＋ 新建”（= 顶部抽屉“新建笔记”功能复用）

---

本文档到此为止。如需我将该设计进一步细化为“前端事件与本地存储的数据结构定义（TypeScript 接口/JSON Schema）”，请告知。
